<?php

class PolicyMS_Asset_Type {
    
    public function __construct(
        public string $id,
        public string $label, 
        public string $label_plural, 
        public string $mimetypes, 
        public string $notice = '') {
        $this->id = $id;
        $this->label = $label;
        $this->label_plural = $label_plural;
        $this->mimetypes = $mimetypes;
        $this->notice = $notice;
    }

    public function get_extensions() {
        return array_map(
			function ( $mimetypes ) {
				return explode( '/', $mimetypes )[1];
			},
			explode( ',', $this->mimetypes ?? '' )
		);
    }

    public function in_gallery() {
        return ( 'image' === $this->id || 'video' === $this->id );
    }

    public static function get_supported_types() {
        return (
            array(
                new self(
                    'image',
                    'Image',
                    'Images',
                    'image/jpeg,image/png'
                ),
                new self(
                    'video',
                    'Video',
                    'Videos',
                    'video/mp4,video/ogg,video/webm',
                    'Uploaded gallery videos are publicly accessible. Please do not include sensitive or protected information.'
                ),
                new self(
                    'file',
                    'File',
                    'Files',
                    ''
                ),
            )
        );
    }

    public static function get_information(string $id) {
        foreach (self::get_supported_types() as $supported_type) {
            if($id === $supported_type->id) {
                return $supported_type;
            }
        }
    }
}